<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>織夢 - 主頁</title>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body, html { height:100%; font-family:"Microsoft JhengHei",sans-serif; color:white; overflow:hidden; }

        /* 背景 */
        #background {
            position:fixed; top:0; left:0; width:100%; height:100%; object-fit:cover; z-index:-2;
        }

        /* 遮罩（調淡一點） */
        .overlay {
            position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.35); z-index:-1;
        }

        /* 登入畫面 */
        #login-container {
            position:fixed; top:0; left:0; width:100%; height:100%;
            display:flex; justify-content:center; align-items:center; background:rgba(0,0,0,0.6); z-index:10;
        }

        .login-box {
            background:rgba(0,0,0,0.7); padding:40px 60px; border-radius:15px; text-align:center; width:380px;
            box-shadow:0 0 30px rgba(0,255,255,0.3);
        }

        h1 { font-size:2.8rem; margin-bottom:30px; color:#00ffff; text-shadow:0 0 10px cyan; }
        .input-group { margin:20px 0; text-align:left; }
        label { display:block; margin-bottom:8px; font-size:1.1rem; }
        input { width:100%; padding:12px; border:none; border-radius:8px; font-size:1.1rem;
                background:rgba(255,255,255,0.15); color:white; }
        input:focus { outline:none; box-shadow:0 0 10px cyan; }
        button { margin:15px 10px; padding:12px 30px; font-size:1.2rem; border:none; border-radius:8px; cursor:pointer; }
        #loginBtn { background:#00d4ff; color:black; }
        #registerBtn { background:#ff00aa; color:white; }
        button:hover { transform:scale(1.05); box-shadow:0 0 15px currentColor; }
        #message { margin-top:20px; min-height:25px; color:#ffcc00; font-weight:bold; }

        /* 主頁面 */
        #main-page { display:none; height:100%; position:relative; }

        .main-container { display:flex; height:100%; position:relative; }

        /* 左側（透明，不加模糊） */
        .left-panel {
            width:25%; padding:20px 30px; display:flex; flex-direction:column; justify-content:space-between;
            background: transparent; /* 完全透明 */
        }

        .top-buttons { display:flex; gap:15px; flex-wrap:wrap; }
        .top-buttons button {
            padding:8px 16px; background:rgba(255,255,255,0.15); border:none; border-radius:6px;
            color:white; cursor:pointer; font-size:1rem;
        }
        .top-buttons button:hover { background:rgba(0,255,255,0.4); }

        .player-info { text-align:center; margin:40px 0; }
        .player-info h2 { font-size:2rem; margin-bottom:8px; text-shadow:1px 1px 3px black; }
        .player-info p { font-size:1.2rem; opacity:0.9; }

        .bottom-buttons { display:flex; flex-direction:column; gap:15px; }
        .bottom-buttons button {
            padding:14px; background:rgba(255,255,255,0.15); border:none; border-radius:8px;
            color:white; font-size:1.1rem; cursor:pointer;
        }
        .bottom-buttons button:hover { background:rgba(255,255,255,0.35); }

        /* 右側（按鈕靠右） */
        .right-panel {
            width:75%; padding:30px; display:flex; flex-direction:column; gap:25px;
            align-items:flex-end; /* 全部靠右對齊 */
        }

        .resources {
            display:flex; gap:25px; font-size:1.2rem;
        }
        .resources span {
            background:rgba(0,0,0,0.6); padding:8px 18px; border-radius:8px; white-space:nowrap;
        }

        /* 終端 - 大按鈕，靠右 */
        .big-button {
            padding:25px 40px; font-size:1.8rem; background:linear-gradient(135deg,#00d4ff,#0077b6);
            border:none; border-radius:12px; color:white; cursor:pointer; width:fit-content;
        }
        .big-button:hover { transform:scale(1.05); box-shadow:0 0 25px #00d4ff; }

        /* 其他按鈕群 - 靠右，小一點 */
        .button-row {
            display:flex; gap:12px; flex-wrap:wrap; justify-content:flex-end; /* 靠右 */
            max-width:80%; /* 限制寬度 */
        }
        .button-row button {
            flex:0 1 auto; min-width:100px; padding:12px 20px;
            background:rgba(255,255,255,0.18); border:1px solid rgba(255,255,255,0.3);
            border-radius:8px; color:white; cursor:pointer; font-size:1rem;
        }
        .button-row button:hover { background:rgba(0,255,255,0.35); }

        /* 看板角色 - 右下角，壓在按鈕「後面」 */
        #operator-center {
            position: absolute; top: 50%;
            left: 50%; transform: translate(-50%, -50%);
            max-height:85vh; max-width:40vw;
            object-fit:contain; z-index:0; pointer-events:none;
        }

        /* 預覽模式 */
        .preview-mode .left-panel,
        .preview-mode .right-panel,
        .preview-mode .overlay { display:none !important; }
    </style>
</head>
<body>

    <img id="background" src="images/background.jpg" alt="背景">
    <div class="overlay" id="overlay"></div>

    <!-- 登入畫面 -->
    <div id="login-container">
        <div class="login-box">
            <h1>織夢</h1>
            <div class="input-group">
                <label for="username">玩家名稱（ID）</label>
                <input type="text" id="username" placeholder="例如：小明博士" autocomplete="off">
            </div>
            <div class="input-group">
                <label for="password">密碼</label>
                <input type="password" id="password" placeholder="請輸入密碼">
            </div>
            <button id="loginBtn">登入</button>
            <button id="registerBtn">創建新帳號</button>
            <div id="message"></div>
        </div>
    </div>

    <!-- 主頁面 -->
    <div id="main-page">
        <img id="operator-center" src="images/operator/default.png" alt="看板角色">

        <div class="main-container">
            <!-- 左側 -->
            <div class="left-panel">
                <div class="top-buttons">
                    <button>設定</button>
                    <button>郵件</button>
                    <button>公告</button>
                </div>

                <div class="player-info">
                    <h2 id="player-name">博士</h2>
                    <p>等級：1</p>
                </div>

                <div class="bottom-buttons">
                    <button>好友</button>
                    <button>主頁編輯</button>
                    <button id="preview-btn">預覽</button>
                </div>
            </div>

            <!-- 右側 -->
            <div class="right-panel">
                <div class="resources">
                    <span id="lmd">龍門幣：0</span>
                    <span id="orundum">合成玉：0</span>
                    <span id="originium">至純源石：0</span>
                </div>

                <button class="big-button" id="terminal-btn">終端<br>理智 100/100</button>

                <div class="button-row">
                    <button>編隊</button>
                    <button>幹員</button>
                </div>

                <div class="button-row">
                    <button>商城</button>
                    <button>公開招募</button>
                    <button>幹員尋訪</button>
                </div>

                <div class="button-row">
                    <button>任務</button>
                    <button>基建</button>
                    <button>倉庫</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 元素
        const loginContainer = document.getElementById('login-container');
        const mainPage = document.getElementById('main-page');
        const message = document.getElementById('message');
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        const playerName = document.getElementById('player-name');

        // 讀取/儲存工具
        function getAccounts() {
            const data = localStorage.getItem('zhimeng_accounts');
            return data ? JSON.parse(data) : { accounts: {} };
        }

        function saveAccounts(data) {
            localStorage.setItem('zhimeng_accounts', JSON.stringify(data));
        }

        function getPlayerData(id) {
            const data = localStorage.getItem(`player_${id}`);
            return data ? JSON.parse(data) : null;
        }

        function savePlayerData(id, data) {
            localStorage.setItem(`player_${id}`, JSON.stringify(data));
            }

        function showMessage(text, isError = false) {
            message.style.color = isError ? '#ff4444' : '#00ff88';
            message.textContent = text;
        }

        // 登入
        document.getElementById('loginBtn').addEventListener('click', () => {
            const id = usernameInput.value.trim();
            const pw = passwordInput.value;

            if (!id || !pw) return showMessage('請輸入玩家名稱和密碼！', true);

            const accounts = getAccounts();
            if (!accounts.accounts[id]) return showMessage('該ID不存在，請點擊「創建帳號」', true);
            if (accounts.accounts[id] !== pw) return showMessage('密碼錯誤，請重新輸入密碼', true);

            // 登入成功
            localStorage.setItem('current_user', id);
            showMessage('登入成功！即將進入織夢世界...', false);

            setTimeout(() => {
                loginContainer.style.display = 'none';
                mainPage.style.display = 'block';
                loadAndDisplayPlayerData(id);
            }, 1500);
        });

        // 註冊
        document.getElementById('registerBtn').addEventListener('click', () => {
            const id = usernameInput.value.trim();
            const pw = passwordInput.value;

            if (!id || !pw) return showMessage('請輸入玩家名稱和密碼！', true);
            if (id.length < 3) return showMessage('玩家名稱至少要 3 個字！', true);

            const accounts = getAccounts();
            if (accounts.accounts[id]) return showMessage('該ID已存在，請點擊「登入」', true);

            accounts.accounts[id] = pw;
            saveAccounts(accounts);

            // 自動建立玩家初始資料
            const initialData = {
                level: 1,
                lmd: 10000,
                orundum: 500,
                originium: 5,
                sanity: 100,
                maxSanity: 100,
                operatorCenter: "default.png"  // 看板角色
            };
            savePlayerData(id, initialData);

            showMessage('帳號創建成功！現在可以登入囉～', false);
            // 自動填入剛創的帳號，方便直接登入
            usernameInput.value = id;
            passwordInput.value = pw;  // 順便填密碼，方便測試
        });

        // 載入並顯示玩家資料
        function loadAndDisplayPlayerData(id) {
            let data = getPlayerData(id);
            if (!data) {
                // 如果資料不見，重置初始
                data = {
                    level: 1,
                    lmd: 10000,
                    orundum: 500,
                    originium: 5,
                    sanity: 100,
                    maxSanity: 100,
                    operatorCenter: "default.png"
                };
                savePlayerData(id, data);
            }

            // 顯示到畫面
            playerName.textContent = id;
            document.getElementById('lmd-value').textContent = data.lmd;
            document.getElementById('orundum-value').textContent = data.orundum;
            document.getElementById('originium-value').textContent = data.originium;

            // 更新終端理智
            document.getElementById('terminal-btn').innerHTML = `終端<br>理智 ${data.sanity}/${data.maxSanity}`;

            // 更新看板角色
            document.getElementById('operator-center').src = `images/operator/${data.operatorCenter}`;
        }

        // 頁面載入時檢查是否已登入
        window.addEventListener('load', () => {
            const current = localStorage.getItem('current_user');
            const accounts = getAccounts();
            if (current && accounts.accounts[current]) {
                loginContainer.style.display = 'none';
                mainPage.style.display = 'block';
                loadAndDisplayPlayerData(current);
            }
        });

        // 登出
        document.getElementById('logout-btn').addEventListener('click', () => {
            localStorage.removeItem('current_user');
            mainPage.style.display = 'none';
            loginContainer.style.display = 'flex';
            showMessage('');
            usernameInput.value = '';
            passwordInput.value = '';
        });

        // 預覽模式
        document.getElementById('preview-btn').addEventListener('click', (e) => {
            e.stopPropagation();
            document.body.classList.add('preview-mode');
        });

        document.addEventListener('click', (e) => {
            if (document.body.classList.contains('preview-mode') && e.target.id !== 'preview-btn') {
                document.body.classList.remove('preview-mode');
            }
        });

        // 其他按鈕基本互動（先用 alert 提示）
        const buttons = ['terminal-btn', '編隊', '幹員', '商城', '公開招募', '幹員尋訪', '任務', '基建', '倉庫'];
        buttons.forEach(idOrText => {
            const btn = typeof idOrText === 'string' && document.getElementById(idOrText) ||
                        Array.from(document.querySelectorAll('button')).find(b => b.textContent.includes(idOrText));
            if (btn) {
                btn.addEventListener('click', () => {
                    alert(`${btn.textContent.trim()} 功能還在施工中～`);
                });
            }
        });
    </script>
</body>
</html>