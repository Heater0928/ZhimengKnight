<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>織夢 - 主頁</title>
    <script src="script.js"></script>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body, html { height:100%; font-family:"Microsoft JhengHei",sans-serif; color:white; overflow:hidden; }

        /* 背景 */
        #background {
            position:fixed; top:0; left:0; width:100%; height:100%; object-fit:cover; z-index:-2;
        }

        /* 遮罩（調淡一點） */
        .overlay {
            position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.35); z-index:-1;
        }

        /* 登入畫面 */
        #login-container {
            position:fixed; top:0; left:0; width:100%; height:100%;
            display:flex; justify-content:center; align-items:center; background:rgba(0,0,0,0.6); z-index:10;
        }

        .login-box {
            background:rgba(0,0,0,0.7); padding:40px 60px; border-radius:15px; text-align:center; width:380px;
            box-shadow:0 0 30px rgba(0,255,255,0.3);
        }

        h1 { font-size:2.8rem; margin-bottom:30px; color:#00ffff; text-shadow:0 0 10px cyan; }
        .input-group { margin:20px 0; text-align:left; }
        label { display:block; margin-bottom:8px; font-size:1.1rem; }
        input { width:100%; padding:12px; border:none; border-radius:8px; font-size:1.1rem;
                background:rgba(255,255,255,0.15); color:white; }
        input:focus { outline:none; box-shadow:0 0 10px cyan; }
        button { margin:15px 10px; padding:12px 30px; font-size:1.2rem; border:none; border-radius:8px; cursor:pointer; }
        #loginBtn { background:#00d4ff; color:black; }
        #registerBtn { background:#ff00aa; color:white; }
        button:hover { transform:scale(1.05); box-shadow:0 0 15px currentColor; }
        #message { margin-top:20px; min-height:25px; color:#ffcc00; font-weight:bold; }

        /* 主頁面 */
        #main-page { display:none; height:100%; position:relative; }

        .main-container { display:flex; height:100%; position:relative; }

        /* 左側（透明，不加模糊） */
        .left-panel {
            width:25%; padding:20px 30px; display:flex; flex-direction:column; justify-content:space-between;
            background: transparent; /* 完全透明 */
        }

        .top-buttons { display:flex; gap:15px; flex-wrap:wrap; }
        .top-buttons button {
            padding:8px 16px; background:rgba(255,255,255,0.15); border:none; border-radius:6px;
            color:white; cursor:pointer; font-size:1rem;
        }
        .top-buttons button:hover { background:rgba(0,255,255,0.4); }

        .player-info { text-align:center; margin:40px 0; }
        .player-info h2 { font-size:2rem; margin-bottom:8px; text-shadow:1px 1px 3px black; }
        .player-info p { font-size:1.2rem; opacity:0.9; }

        .bottom-buttons { display:flex; flex-direction:column; gap:15px; }
        .bottom-buttons button {
            padding:14px; background:rgba(255,255,255,0.15); border:none; border-radius:8px;
            color:white; font-size:1.1rem; cursor:pointer;
        }
        .bottom-buttons button:hover { background:rgba(255,255,255,0.35); }

        /* 右側（按鈕靠右） */
        .right-panel {
            width:75%; padding:30px; display:flex; flex-direction:column; gap:25px;
            align-items:flex-end; /* 全部靠右對齊 */
        }

        .resources {
            display:flex; gap:25px; font-size:1.2rem;
        }
        .resources span {
            background:rgba(0,0,0,0.6); padding:8px 18px; border-radius:8px; white-space:nowrap;
        }

        /* 終端 - 大按鈕，靠右 */
        .big-button {
            padding:25px 40px; font-size:1.8rem; background:linear-gradient(135deg,#00d4ff,#0077b6);
            border:none; border-radius:12px; color:white; cursor:pointer; width:fit-content;
        }
        .big-button:hover { transform:scale(1.05); box-shadow:0 0 25px #00d4ff; }

        /* 其他按鈕群 - 靠右，小一點 */
        .button-row {
            display:flex; gap:12px; flex-wrap:wrap; justify-content:flex-end; /* 靠右 */
            max-width:80%; /* 限制寬度 */
        }
        .button-row button {
            flex:0 1 auto; min-width:100px; padding:12px 20px;
            background:rgba(255,255,255,0.18); border:1px solid rgba(255,255,255,0.3);
            border-radius:8px; color:white; cursor:pointer; font-size:1rem;
        }
        .button-row button:hover { background:rgba(0,255,255,0.35); }

        /* 看板角色 - 右下角，壓在按鈕「後面」 */
        #operator-center {
            position: absolute; top: 50%;
            left: 50%; transform: translate(-50%, -50%);
            max-height:85vh; max-width:40vw;
            object-fit:contain; z-index:0; pointer-events:none;
        }

        /* 預覽模式 */
        .preview-mode .left-panel,
        .preview-mode .right-panel,
        .preview-mode .overlay { display:none !important; }

        .skill-btn {
            width: 60px !important;
            height: 60px !important;
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;  /* 確保圖片不溢出 */
            padding: 0;  /* 移除 padding 避免擠壓 */
        }

        .skill-btn img {
            width: 100% !important;
            height: 100% !important;
            object-fit: cover;
            display: block;  /* 強制顯示 */
        }
    </style>
</head>
<body>

    <img id="background" src="images/background.jpg" alt="背景">
    <div class="overlay" id="overlay"></div>

    <!-- 登入畫面 -->
    <div id="login-container">
        <div class="login-box">
            <h1>織夢</h1>
            <div class="input-group">
                <label for="username">玩家名稱（ID）</label>
                <input type="text" id="username" placeholder="例如：小明博士" autocomplete="off">
            </div>
            <div class="input-group">
                <label for="password">密碼</label>
                <input type="password" id="password" placeholder="請輸入密碼">
            </div>
            <button id="loginBtn">登入</button>
            <button id="registerBtn">創建新帳號</button>
            <div id="message"></div>
        </div>
    </div>

    <!-- 主頁面 -->
    <div id="main-page">
        <img id="operator-center" src="images/operator/default.png" alt="看板角色">
    <!-- 設定頁面（先隱藏） -->
    <div id="settings-page" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:5; color:white; display:flex; justify-content:center; align-items:center; flex-direction:column;">
        <h2>設定</h2>
        <button id="logout-btn" style="margin-top:30px; padding:15px 40px; font-size:1.4rem; background:#ff4444; border:none; border-radius:10px; color:white; cursor:pointer;">
            帳號登出
        </button>
        <button onclick="document.getElementById('settings-page').style.display='none';" style="margin-top:20px; padding:10px 20px; background:rgba(255,255,255,0.2); border:none; border-radius:8px; color:white;">
            返回主頁
        </button>
    </div>

        <div class="main-container">
            <!-- 左側 -->
            <div class="left-panel">
                <div class="top-buttons">
                    <button>設定</button>
                    <button>郵件</button>
                    <button>公告</button>
                </div>

                <div class="player-info">
                    <h2 id="player-name">博士</h2>
                    <p>等級：1</p>
                </div>

                <div class="bottom-buttons">
                    <button>好友</button>
                    <button>主頁編輯</button>
                    <button id="preview-btn">預覽</button>
                </div>
            </div>

            <!-- 右側 -->
            <div class="right-panel">
                <div class="resources">
                    <span id="lmd">龍門幣：0</span>
                    <span id="orundum">合成玉：0</span>
                    <span id="originium">至純源石：0</span>
                </div>

                <button class="big-button" id="terminal-btn">終端<br>理智 100/100</button>

                <div class="button-row">
                    <button>編隊</button>
                    <button>幹員</button>
                </div>

                <div class="button-row">
                    <button>商城</button>
                    <button>公開招募</button>
                    <button>幹員尋訪</button>
                </div>

                <div class="button-row">
                    <button>任務</button>
                    <button>基建</button>
                    <button>倉庫</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 幹員列表頁面（先隱藏） -->
    <div id="operators-page" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); z-index:4; color:white; overflow-y:auto;">
        <div style="padding:20px; max-width:1400px; margin:0 auto; position:relative;">
            <!-- 左上角：回主頁箭頭 -->
            <button id="back-to-main" style="position:absolute; top:20px; left:20px; background:transparent; border:none; font-size:2.5rem; color:#00ffff; cursor:pointer;">
                ←
            </button>
            <!-- 右邊：職業篩選列（固定在右側） -->
            <div style="position:fixed; right:20px; top:20px; bottom:20px; display:flex; flex-direction:column; gap:10px; overflow-y:auto; z-index:5;">
                <button class="class-filter" data-class="all" style="padding:8px; background:rgba(255,255,255,0.2); border:none; border-radius:8px; color:white; font-size:1rem; cursor:pointer;">
                    ALL
                </button>
                <button class="class-filter" data-class="pioneer">
                    <img src="images/classes/pioneer.png" alt="先鋒" style="width:50px; height:50px; object-fit:contain;">
                </button>
                <button class="class-filter" data-class="guard">
                    <img src="images/classes/guard.png" alt="近衛" style="width:50px; height:50px; object-fit:contain;">
                </button>
                <button class="class-filter" data-class="defender">
                    <img src="images/classes/defender.png" alt="重裝" style="width:50px; height:50px; object-fit:contain;">
                </button>
                <button class="class-filter" data-class="sniper">
                    <img src="images/classes/sniper.png" alt="狙擊" style="width:50px; height:50px; object-fit:contain;">
                </button>
                <button class="class-filter" data-class="caster">
                    <img src="images/classes/caster.png" alt="術士" style="width:50px; height:50px; object-fit:contain;">
                </button>
                <button class="class-filter" data-class="medic">
                    <img src="images/classes/medic.png" alt="醫療" style="width:50px; height:50px; object-fit:contain;">
                </button>
                <button class="class-filter" data-class="supporter">
                    <img src="images/classes/supporter.png" alt="輔助" style="width:50px; height:50px; object-fit:contain;">
                </button>
                <button class="class-filter" data-class="special">
                    <img src="images/classes/special.png" alt="特種" style="width:50px; height:50px; object-fit:contain;">
                </button>
            </div>
            <!-- 幹員列表區域（之後放兩排圖標） -->
            <div id="operators-grid" style="display:grid; grid-template-rows:repeat(2, minmax(170px, 1fr)); grid-auto-flow:row; grid-auto-flow:column; gap:15px 15px; padding:100px 20px 20px 20px; justify-content:flex-start;">
                <!-- 這裡之後會用 JS 動態生成幹員卡片 -->
                <p style="grid-column:1 / -1; text-align:center; font-size:1.5rem; opacity:0.7;">
                    （幹員列表施工中，很快就會有角色出現～）
                </p>
            </div>
        </div>
    </div>

    <!-- 幹員詳細頁面（先隱藏） -->
    <div id="operator-detail-page" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); z-index:5; color:white; overflow-y:auto;">
        <div style="padding:40px; max-width:1600px; margin:0 auto; position:relative; display:flex; justify-content:space-between; gap:40px;">

            <!-- 左側：屬性 + 資訊 -->
            <div style="width:30%; display:flex; flex-direction:column; gap:20px;">
                <!-- 返回箭頭 -->
                <button id="back-to-list" style="align-self:flex-start; background:transparent; border:none; font-size:2.5rem; color:#00ffff; cursor:pointer;">
                    ←
                </button>

                <!-- 屬性列表 -->
                <div id="detail-stats" style="background:rgba(255,255,255,0.1); padding:20px; border-radius:12px;">
                    <h3>屬性</h3>
                    <ul style="list-style:none; line-height:2;">
                        <li><strong>生命上限：</strong><span id="detail-hp">---</span></li>
                        <li><strong>攻擊力：</strong><span id="detail-atk">---</span></li>
                        <li><strong>防禦力：</strong><span id="detail-def">---</span></li>
                        <li><strong>法術抗性：</strong><span id="detail-magicResist">---</span></li>
                        <li><strong>再部署時間：</strong><span id="detail-redeployTime">---</span>秒</li>
                        <li><strong>部署費用：</strong><span id="detail-cost">---</span></li>
                        <li><strong>阻擋數：</strong><span id="detail-blockCount">---</span></li>
                        <li><strong>攻擊速度：</strong><span id="detail-attackInterval">---</span>秒</li>
                    </ul>
                </div>

                <!-- 信賴值 -->
                <div style="background:rgba(255,255,255,0.1); padding:15px; border-radius:8px;">
                    <strong>信賴值：</strong> <span id="detail-trust">0</span>
                </div>

                <!-- 星星 + 姓名 + 職業 + 站位 + 標籤 -->
                <div style="display:flex; align-items:center; gap:15px;">
                    <div id="detail-rarity" style="font-size:2rem; color:#ffd700;"></div>
                    <h2 id="detail-name" style="font-size:2.2rem; margin:0;"></h2>
                </div>

                <div style="display:flex; align-items:center; gap:15px;">
                    <img id="detail-class-icon" src="" alt="職業" style="width:60px; height:60px; object-fit:contain;">
                    <div>
                        <div id="detail-position"></div>
                        <div id="detail-labels"></div>
                    </div>
                </div>
            </div>

            <!-- 中間：全身立繪 -->
            <div style="width:35%; display:flex; justify-content:center; align-items:center;">
                <img id="detail-full-portrait" src="" alt="全身立繪" style="max-height:90vh; max-width:100%; object-fit:contain;">
            </div>

            <!-- 右側：等級、精英化、潛能、技能、天賦 -->
            <div style="width:35%; display:flex; flex-direction:column; gap:20px;">

                <!-- 等級 -->
                <div style="background:rgba(255,255,255,0.1); padding:15px; border-radius:8px; text-align:center;">
                    <strong>等級：</strong> <span id="detail-level">1</span> / <span id="detail-maxLevel">70</span>
                </div>

                <!-- 精英化 + 潛能 -->
                <div style="display:flex; gap:15px;">
                    <div style="flex:1; background:rgba(255,255,255,0.1); padding:15px; border-radius:8px; text-align:center;">
                        <strong>精英化：</strong> <span id="detail-elite">0</span>階
                    </div>
                    <div style="flex:1; background:rgba(255,255,255,0.1); padding:15px; border-radius:8px; text-align:center;">
                        <strong>潛能：</strong> <span id="detail-potential">1</span>
                    </div>
                </div>

                <!-- 技能 -->
                <div style="background:rgba(255,255,255,0.1); padding:15px; border-radius:8px;">
                    <h3>技能</h3>
                    <div style="display:flex; gap:10px; flex-wrap:wrap;">
                        <button class="skill-btn" data-skill="0" style="width:60px; height:60px; background:rgba(255,255,255,0.2); border:none; border-radius:8px; cursor:pointer;">
                            <img src="" alt="技能1" style="width:100%; height:100%; object-fit:cover;" id="skill-icon-0">
                        </button>
                        <button class="skill-btn" data-skill="1" style="width:60px; height:60px; background:rgba(255,255,255,0.2); border:none; border-radius:8px; cursor:pointer;">
                            <img src="" alt="技能2" style="width:100%; height:100%; object-fit:cover;" id="skill-icon-1">
                        </button>
                        <button class="skill-btn" data-skill="2" style="width:60px; height:60px; background:rgba(255,255,255,0.2); border:none; border-radius:8px; cursor:pointer;">
                            <img src="" alt="技能3" style="width:100%; height:100%; object-fit:cover;" id="skill-icon-2">
                        </button>
                        <div style="flex:1; text-align:center; align-self:center;">
                            <strong>技能等級：</strong> <span id="detail-skillLevel">1</span>
                        </div>
                    </div>
                </div>

                <!-- 天賦 -->
                <div style="background:rgba(255,255,255,0.1); padding:15px; border-radius:8px;">
                    <h3>天賦</h3>
                    <div id="detail-talents"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 取得元素
        const loginContainer = document.getElementById('login-container');
        const mainPage = document.getElementById('main-page');
        const message = document.getElementById('message');
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        // 讀取或初始化所有帳號資料
        function getAccounts() {
            const data = localStorage.getItem('zhimeng_accounts');
            return data ? JSON.parse(data) : { accounts: {} };
        }
        function saveAccounts(data) {
            localStorage.setItem('zhimeng_accounts', JSON.stringify(data));
        }
        // 讀取/初始化玩家個人資料（資源等）
        function getPlayerData(id) {
            const key = 'player_data_' + id;
            const data = localStorage.getItem(key);
            let player = data ? JSON.parse(data) : null;

            // 如果沒有資料，就給新玩家預設值
            if (!player) {
                player = {
                    lmd: 10000,         // 龍門幣
                    orundum: 500,       // 合成玉
                    originium: 5,       // 至純源石
                    sanity: 100,        // 當前理智
                    maxSanity: 100,     // 最大理智
                    operatorCenter: 'default.png'  // 看板角色（之後會改成可選）
                };
                localStorage.setItem(key, JSON.stringify(player));
            }

            return player;
        }
        // 顯示訊息（綠色成功 / 紅色錯誤）
        function showMessage(text, isError = false) {
            message.style.color = isError ? '#ff4444' : '#00ff88';
            message.textContent = text;
        }
        // 登入功能
        document.getElementById('loginBtn').addEventListener('click', () => {
            const id = usernameInput.value.trim();
            const pw = passwordInput.value;

            if (!id || !pw) {
                showMessage('請輸入玩家名稱和密碼！', true);
                return;
            }

            const data = getAccounts();

            if (!data.accounts[id]) {
                // ID 不存在 → 明確提示去創建
                showMessage('該ID不存在，請點擊「創建帳號」', true);
                return;
            }

            if (data.accounts[id] === pw) {
                // 登入成功
                localStorage.setItem('current_user', id);
                showMessage('登入成功！即將進入織夢世界...', false);
                setTimeout(() => {
                    loginContainer.style.display = 'none';
                    mainPage.style.display = 'block';

                    // 讀取玩家資料
                    const playerData = getPlayerData(id);
                    playerName.textContent = id;

                    // 更新資源顯示
                    document.getElementById('lmd').textContent = `龍門幣：${playerData.lmd}`;
                    document.getElementById('orundum').textContent = `合成玉：${playerData.orundum}`;
                    document.getElementById('originium').textContent = `至純源石：${playerData.originium}`;

                    // 之後會加看板角色換圖
                    // document.getElementById('operator-center').src = 'images/operator/' + playerData.operatorCenter;
                }, 1500);
            } else {
                // 密碼錯誤
                showMessage('密碼錯誤，請重新輸入密碼', true);
            }
        });
        // 創建新帳號
        document.getElementById('registerBtn').addEventListener('click', () => {
            const id = usernameInput.value.trim();
            const pw = passwordInput.value;

            if (!id || !pw) {
                showMessage('請輸入玩家名稱和密碼！', true);
                return;
            }

            if (id.length < 3) {
                showMessage('玩家名稱至少要 3 個字！', true);
                return;
            }

            const data = getAccounts();

            if (data.accounts[id]) {
                // 已存在 → 明確提示去登入
                showMessage('該ID已存在，請點擊「登入」', true);
                return;
            }

            // 建立新帳號
            data.accounts[id] = pw;
            saveAccounts(data);

            showMessage('帳號創建成功！現在可以登入囉～', false);
            // 自動填入剛創的帳號，方便直接登入
            usernameInput.value = id;
            passwordInput.value = pw;  // 順便填密碼，方便測試
        });
        // 登出功能（主頁面用）
        function logout() {
            localStorage.removeItem('current_user');
            mainPage.style.display = 'none';
            loginContainer.style.display = 'block';
            showMessage('');
            usernameInput.value = '';
            passwordInput.value = '';
        }
        // 頁面載入時：如果已經有登入，就直接進主頁
        window.addEventListener('load', () => {
            const current = localStorage.getItem('current_user');
            if (current && getAccounts().accounts[current]) {
                loginContainer.style.display = 'none';
                mainPage.style.display = 'block';  // 改成 block 比較穩

                // 讀取玩家資料並顯示
                const playerData = getPlayerData(current);
                document.getElementById('player-name').textContent = current;
                document.getElementById('lmd').textContent = `龍門幣：${playerData.lmd}`;
                document.getElementById('orundum').textContent = `合成玉：${playerData.orundum}`;
                document.getElementById('originium').textContent = `至純源石：${playerData.originium}`;

                // 之後加看板角色
                // document.getElementById('operator-center').src = 'images/operator/' + playerData.operatorCenter;
            }
        });

        // 預覽模式（同之前）
        document.getElementById('preview-btn').addEventListener('click', (e) => {
            e.stopPropagation();
            document.body.classList.add('preview-mode');
        });
        document.addEventListener('click', (e) => {
            if (document.body.classList.contains('preview-mode') && e.target.id !== 'preview-btn') {
                document.body.classList.remove('preview-mode');
            }
        });

        // 開啟幹員列表頁面（點擊主頁的「幹員」按鈕）
        document.querySelector('.button-row button:nth-child(2)').addEventListener('click', () => {
            document.getElementById('main-page').style.display = 'none';
            document.getElementById('operators-page').style.display = 'block';

            // 生成幹員卡片
            generateOperatorsGrid();
        });
        // 回主頁箭頭
        document.getElementById('back-to-main').addEventListener('click', (e) => {
            e.preventDefault();   // 阻止任何預設行為
            e.stopPropagation();  // 阻止事件往上冒泡，避免觸發其他監聽
            e.stopImmediatePropagation();     // 阻止同一元素其他監聽器執行（最強）
            console.log('返回箭頭被點擊了，應該直接回主頁');  // 加這行 debug
            document.getElementById('operators-page').style.display = 'none';
            document.getElementById('main-page').style.display = 'block';
        });
        // 生成幹員卡片（點擊「幹員」時執行）
        function generateOperatorsGrid() {
            const grid = document.getElementById('operators-grid');
            grid.innerHTML = '';  // 清空原本的施工中文字
            // 新增：先排序 operators
            operators.sort((a, b) => {
                // 1. level 降序
                if (b.level !== a.level) return b.level - a.level;
                // 2. 同 level → rarity 降序
                if (b.rarity !== a.rarity) return b.rarity - a.rarity;
                // 3. 同 level 同 rarity → 職業順序降序（自訂順序）
                const classOrder = {
                    'pioneer': 8,
                    'guard': 7,
                    'defender': 6,
                    'sniper': 5,
                    'caster': 4,
                    'medic': 3,
                    'supporter': 2,
                    'special': 1
                };
                const orderA = classOrder[a.class] || 0;
                const orderB = classOrder[b.class] || 0;
                if (orderA !== orderB) return orderB - orderA;  // 降序（數字越大越先）

                // 4. 同以上 → serial_number 升序（假設你有加 serial_number 屬性）
                if (a.serial_number !== b.serial_number) return a.serial_number - b.serial_number;

                return 0;
            });
            operators.forEach(op => {
                const card = document.createElement('div');
                card.style.position = 'relative';
                card.style.background = 'rgba(255,255,255,0.1)';
                card.style.borderRadius = '12px';
                card.style.overflow = 'hidden';
                card.style.textAlign = 'center';
                card.style.padding = '10px';

                // 頭像
                const img = document.createElement('img');
                img.src = op.portrait;
                img.alt = op.portraitAlt;
                img.style.width = '100%';
                img.style.height = 'auto';
                img.style.borderRadius = '8px';
                card.appendChild(img);

                // 左下：等級
                const level = document.createElement('div');
                level.textContent = `Lv.${op.level}`;
                level.style.position = 'absolute';
                level.style.bottom = '8px';
                level.style.left = '8px';
                level.style.background = 'rgba(0,0,0,0.6)';
                level.style.padding = '2px 6px';
                level.style.borderRadius = '4px';
                level.style.fontSize = '2.0rem';
                card.appendChild(level);

                // 右下：名字
                const name = document.createElement('div');
                name.textContent = op.name;
                name.style.position = 'absolute';
                name.style.bottom = '8px';
                name.style.right = '8px';
                name.style.background = 'rgba(0,0,0,0.6)';
                name.style.padding = '2px 6px';
                name.style.borderRadius = '4px';
                name.style.fontSize = '2.0rem';
                card.appendChild(name);

                // 上方：星星（稀有度）
                const stars = document.createElement('div');
                stars.textContent = '★'.repeat(op.rarity);
                stars.style.position = 'absolute';
                stars.style.top = '8px';
                stars.style.left = '50%';
                stars.style.transform = 'translateX(-50%)';
                stars.style.color = '#ffd700';
                stars.style.fontSize = '1.2rem';
                stars.style.textShadow = '0 0 5px black';
                card.appendChild(stars);

                // 左上：職業圖標
                const classIcon = document.createElement('img');
                classIcon.src = `images/classes/${op.class}.png`;
                classIcon.alt = op.class;
                classIcon.style.position = 'absolute';
                classIcon.style.top = '8px';
                classIcon.style.left = '8px';
                classIcon.style.width = '40px';
                classIcon.style.height = '40px';
                classIcon.style.objectFit = 'contain';
                card.appendChild(classIcon);
                card.setAttribute('data-class', op.class);  // 讓每個卡片記住自己的職業

                // 點擊卡片 → 顯示詳細頁面
                card.addEventListener('click', () => {
                    // 填入資料
                    document.getElementById('operators-page').style.display = 'none';
                    document.getElementById('operator-detail-page').style.display = 'flex';
                    document.getElementById('detail-name').textContent = op.name;
                    document.getElementById('detail-full-portrait').src = op.fullPortrait;
                    document.getElementById('detail-level').textContent = op.level;
                    document.getElementById('detail-maxLevel').textContent = op.maxLevel;
                    document.getElementById('detail-elite').textContent = op.elite;
                    document.getElementById('detail-rarity').textContent = '★'.repeat(op.rarity);
                    document.getElementById('detail-class-icon').src = `images/classes/${op.class}.png`;
                    document.getElementById('detail-position').textContent = op.baseStats.position;
                    document.getElementById('detail-labels').textContent = op.baseStats.label ? op.baseStats.label.join('、') : '無';
                    document.getElementById('detail-hp').textContent = op.baseStats.hp;
                    document.getElementById('detail-atk').textContent = op.baseStats.atk;
                    document.getElementById('detail-def').textContent = op.baseStats.def;
                    document.getElementById('detail-magicResist').textContent = op.baseStats.magicResist;
                    document.getElementById('detail-redeployTime').textContent = op.baseStats.redeployTime;
                    document.getElementById('detail-cost').textContent = op.baseStats.cost;
                    document.getElementById('detail-blockCount').textContent = op.baseStats.blockCount;
                    document.getElementById('detail-attackInterval').textContent = op.baseStats.attackInterval;
                    document.getElementById('detail-trust').textContent = op.baseStats.trust;
                    // 新增：重置所有技能圖標為顯示狀態
                    // 重置並正確顯示技能圖標
                    for (let i = 0; i < 3; i++) {
                        const icon = document.getElementById(`skill-icon-${i}`);
                        if (op.skills[i]) {  // 如果這個 index 有技能
                            icon.src = op.skills[i].icon;
                            icon.style.display = 'block';
                        } else {
                            icon.src = '';           // 清空
                            icon.style.display = 'none';
                        }
                    }
                    // 技能圖標（先顯示已解鎖的）
                        op.skills.forEach((skill, index) => {
                            if (skill) {
                                document.getElementById(`skill-icon-${index}`).src = skill.icon;
                            } else {
                                document.getElementById(`skill-icon-${index}`).style.display = 'none';
                            }
                        });
                    });
                grid.appendChild(card);
            });
            // 預設點擊 ALL
            document.querySelector('.class-filter[data-class="all"]').click();
        }
        // 職業篩選功能
        document.querySelectorAll('.class-filter').forEach(btn => {
            btn.addEventListener('click', () => {
                const selectedClass = btn.getAttribute('data-class');  // all, pioneer, guard...

                // 移除所有按鈕的「已選中」樣式
                document.querySelectorAll('.class-filter').forEach(b => b.style.background = 'rgba(255,255,255,0.2)');

                // 給目前點的按鈕加亮（視覺反饋）
                btn.style.background = 'rgba(0,255,255,0.5)';

                // 過濾幹員卡片
                document.querySelectorAll('#operators-grid > div').forEach(card => {
                    // 每個卡片都有 data-class 屬性（我們在生成時加）
                    if (selectedClass === 'all' || card.getAttribute('data-class') === selectedClass) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }
                });
            });
        });
        //幹員詳細頁面的退出按鈕
        document.getElementById('back-to-list').addEventListener('click', () => {
            document.getElementById('operator-detail-page').style.display = 'none';
            document.getElementById('operators-page').style.display = 'block';
        });
        // 開啟設定頁面（點擊「設定」按鈕）
        document.querySelector('.top-buttons button:nth-child(1)').addEventListener('click', () => {
            document.getElementById('settings-page').style.display = 'flex';
        });
        // 登出按鈕
        document.getElementById('logout-btn').addEventListener('click', () => {
            if (confirm('確定要登出嗎？')) {
                localStorage.removeItem('current_user');
                document.getElementById('settings-page').style.display = 'none';
                mainPage.style.display = 'none';
                loginContainer.style.display = 'flex';
            }
        });
    </script>
</body>
</html>